---
apiVersion: batch/v1
kind: CronJob
metadata:
  name: apache-cassandra-loadgen
  namespace: cassandra
spec:
  schedule: "*/1 * * * *"  # Run every 5 minutes instead of every minute
  successfulJobsHistoryLimit: 1
  failedJobsHistoryLimit: 1
  jobTemplate:
    spec:
      ttlSecondsAfterFinished: 60
      parallelism: 1
      backoffLimit: 1
      template:
        spec:
          containers:
            - name: apache-cassandra-loadgen
              image: docker.io/sample/apache-cassandra:0.0.1
              imagePullPolicy: Never
              command: ["/bin/bash", "-c"]
              args:
                - |
                  /opt/cassandra/tools/bin/cassandra-stress write n=1 -node cassandra -mode native cql3 -errors ignore &&
                  /opt/cassandra/tools/bin/cassandra-stress mixed n=100 -node cassandra -mode native cql3 -errors ignore
          restartPolicy: Never
